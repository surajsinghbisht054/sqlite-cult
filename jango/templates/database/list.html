{% extends 'base.html' %}

{% block title %}Databases - SQLite Cult{% endblock %}

{% block content %}
<div class="page-header">
    <div>
        <h1 class="page-title">Databases</h1>
        <p class="page-subtitle">Manage your SQLite databases</p>
    </div>
    <button class="btn btn-primary" onclick="openModal('create-db-modal')">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <line x1="12" y1="5" x2="12" y2="19"></line>
            <line x1="5" y1="12" x2="19" y2="12"></line>
        </svg>
        New Database
    </button>
</div>

{% if databases %}
<div class="grid grid-2">
    {% for db in databases %}
    <div class="database-card">
        <div class="database-card-header">
            <div class="database-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
                    <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
                    <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
                </svg>
            </div>
            <div class="dropdown">
                <button class="btn-icon" onclick="this.parentElement.classList.toggle('active')">
                    <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <circle cx="12" cy="12" r="1"></circle>
                        <circle cx="12" cy="5" r="1"></circle>
                        <circle cx="12" cy="19" r="1"></circle>
                    </svg>
                </button>
                <div class="dropdown-content">
                    <a href="{% url 'database_detail' db.name %}" class="dropdown-item">Open</a>
                    <a href="{% url 'query_history' db.name %}" class="dropdown-item">Query History</a>
                    <div class="dropdown-divider"></div>
                    <a href="#" class="dropdown-item danger" 
                       onclick="confirmDelete('{{ db.name }}', '{% url 'delete_database' db.name %}')">
                        Delete
                    </a>
                </div>
            </div>
        </div>
        <a href="{% url 'database_detail' db.name %}" class="database-name">{{ db.name }}</a>
        <div class="database-meta">
            <span>{{ db.tables_count }} table{{ db.tables_count|pluralize }}</span>
            <span>{{ db.size|floatformat:1 }} KB</span>
        </div>
        <div class="database-actions">
            <a href="{% url 'database_detail' db.name %}" class="btn btn-ghost btn-sm">Open</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="card">
    <div class="empty-state">
        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
            <ellipse cx="12" cy="5" rx="9" ry="3"></ellipse>
            <path d="M21 12c0 1.66-4 3-9 3s-9-1.34-9-3"></path>
            <path d="M3 5v14c0 1.66 4 3 9 3s9-1.34 9-3V5"></path>
        </svg>
        <h3 class="empty-state-title">No databases yet</h3>
        <p class="empty-state-text">Create your first SQLite database to get started.</p>
        <button class="btn btn-primary" onclick="openModal('create-db-modal')">
            Create Database
        </button>
    </div>
</div>
{% endif %}

<!-- Create Database Modal -->
<div id="create-db-modal" class="modal-overlay" onclick="if(event.target===this)closeModal('create-db-modal')">
    <div class="modal">
        <div class="modal-header">
            <h3 class="modal-title">Create New Database</h3>
            <button class="modal-close" onclick="closeModal('create-db-modal')">&times;</button>
        </div>
        <form method="post" action="{% url 'create_database' %}">
            {% csrf_token %}
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label" for="db-name">Database Name</label>
                    <input type="text" name="name" id="db-name" class="form-input" 
                           placeholder="my_database" pattern="[a-zA-Z0-9_-]+" required
                           title="Only letters, numbers, underscores, and hyphens allowed">
                    <small class="text-muted mt-1" style="display: block;">
                        .db extension will be added automatically
                    </small>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-ghost" onclick="closeModal('create-db-modal')">Cancel</button>
                <button type="submit" class="btn btn-primary">Create Database</button>
            </div>
        </form>
    </div>
</div>

<!-- Delete Confirmation -->
<div id="delete-confirm" class="confirm-overlay" style="display: none;">
    <div class="confirm-dialog">
        <h3 class="confirm-title">Delete Database</h3>
        <p class="confirm-message">Are you sure you want to delete "<span id="delete-db-name"></span>"? This action cannot be undone.</p>
        <form id="delete-form" method="post">
            {% csrf_token %}
            <div class="confirm-actions">
                <button type="button" class="btn btn-ghost" onclick="document.getElementById('delete-confirm').style.display='none'">Cancel</button>
                <button type="submit" class="btn btn-danger">Delete</button>
            </div>
        </form>
    </div>
</div>

{% block extra_js %}
<script>
function confirmDelete(name, url) {
    document.getElementById('delete-db-name').textContent = name;
    document.getElementById('delete-form').action = url;
    document.getElementById('delete-confirm').style.display = 'flex';
}
</script>
{% endblock %}
{% endblock %}
